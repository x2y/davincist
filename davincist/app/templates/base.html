{% load tags %}

<!DOCTYPE html>
<html lang="en">
<head>
  <title>{% block tab_title %}{% endblock %}</title>
  {% load staticfiles %}
  <link href="{% static 'base.min.css' %}" rel="stylesheet" type="text/css">
  <script src="{% static 'jquery.min.js' %}"></script>
  <script src="{% static 'jquery.cookie.js' %}"></script>
  <script src="{% static 'jquery.textFit.min.js' %}"></script>
  <script src="{% static 'bootstrap.min.js' %}"></script>
  <script src="{% static 'base.js' %}"></script>
  <script src="{% static 'ajax.js' %}"></script>
  <script>
    function openPopup(url) {
      var w = 700;
      var h = 500;
      var left = 100;
      var top = 100;

      var settings = 'height=' + h + ',width=' + w + ',left=' + left + ',top=' + top + ',resizable=yes,scrollbars=yes,toolbar=no,menubar=no,location=yes,directories=no,status=yes';
      url += "?next={% url login_popup_close %}";

      window.open(url, name, settings);
    }
  </script>
  {% block head %}{% endblock %}
</head>
<body>
  <nav id="header-navbar" class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#header-navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">Fiiire</a>
      </div>

      <div class="collapse navbar-collapse" id="header-navbar-collapse">
        <ul class="nav navbar-nav">
          {% for user_track in user_tracks %}
            <li class="user-track-dropdown dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">{{ user_track.track.name }}</a>
              <table class="dropdown-menu">
                <thead>
                  <tr>
                    <th class="track-links-menu-header">{{ user_track.track.name }}</th>
                    <th class="challenges-menu-header" colspan="3">Challenges</th>
                    <th class="level-menu-header">Level {{ user_track.level.rank }}</th>
                  </tr>
                  <tr>
                    <th class="track-links-menu-subheader">Links</th>
                    <th class="challenges-menu-subheader">Current</th>
                    <th class="challenges-menu-subheader">Upcoming</th>
                    <th class="challenges-menu-subheader">Verify</th>
                    <th class="level-menu-subheader">{{ user_track.level.name }}</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <ul>
                        <li><a href="/t/{{ user_track.track.name }}/">Home</a>
                        <li><a href="/t/{{ user_track.track.name }}/users/">Users</a>
                        <li><a href="/u/{{ user.username }}/">What's next?</a>
                      </ul>
                    </td>
                    <td>
                      {% with current_challenges=user_track.current_challenges|slice:":3" %}
                        {% if current_challenges %}
                          <ul>
                          {% for verification in current_challenges %}
                            <li>{% badge_link verification.badge True True %}
                          {% endfor %}
                          </ul>
                        {% else %}
                          None
                        {% endif %}
                      {% endwith %}
                    </td>
                    <td>
                      {% with next_challenges=user_track.next_challenges|slice:":3" %}
                        {% if next_challenges %}
                          <ul>
                          {% for badge in next_challenges.all %}
                            <li>{% badge_link badge True %}</li>
                          {% endfor %}
                          </ul>
                        {% else %}
                          None
                        {% endif %}
                      {% endwith %}
                    </td>
                    <td>
                      {% with challenges_to_verify=user_track.challenges_to_verify|slice:":3" %}
                        {% if challenges_to_verify %}
                          <ul>
                          {% for verification in challenges_to_verify %}
                            <li>{{ verification }}
                          {% endfor %}
                          </ul>
                        {% else %}
                          None
                        {% endif %}
                      {% endwith %}
                    </td>
                  </tr>
                </tbody>
              </table>
            </li>
          {% endfor %}
          {% for track in unjoined_tracks %}
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">{{ track.name }}</b></a>
              <ul class="dropdown-menu">
                <li><a href="#">Join {{ track.name }}</a></li>
                <li class="divider"></li>
                <li><a href="/t/{{ track.name }}/">Home</a>
                <li><a href="/t/{{ track.name }}/users/">Users</a>
              </ul>
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </nav>
  <div id="content">{% block content %}{% endblock %}</div>
  <footer>{% block footer %}{% endblock %}</footer>
  <div id="dimmer"><div></div></div>
  <div id="feedback-button">
    <a href="https://docs.google.com/forms/d/1_zbBvuiDbOQcYclXsvd9t714Zg5351BMfT-bxh0eWF8/viewform">
      got feedback?
    </a>
  </div>
  <!-- Use two banners for smooth cross-fading. -->
  <div class="banner"><div class="banner-text"></div></div>
  <div class="banner"><div class="banner-text"></div></div>
  {% block footer_script %}{% endblock %}
</body>
</html>
